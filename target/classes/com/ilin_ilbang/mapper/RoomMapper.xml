<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ilin_ilbang.mapper.RoomMapper">
	
	<!-- 전체 리스트 불러오기 -->
	<select id="getListOfAll" resultType="HashMap">
		SELECT i.rcode, i.rtype, i.addr, i.rcmt, i.regdate, p.dep, p.mrent, i.elev, i.park, i.pet 
		FROM room_info i, room_price p
		WHERE i.rcode=p.rcode
		ORDER BY i.regdate desc
	</select>
	
	<!-- 필터 검색으로 리스트 불러오기 -->
	<select id="getListByFilter" resultType="HashMap" parameterType="HashMap">

		 SELECT i.rcode, i.rtype, i.addr, i.rcmt, i.regdate, p.dep, p.mrent, i.elev, i.park, i.pet
		 FROM room_info i INNER JOIN room_price p USING (rcode)
		 
		 <where>
		 	<trim prefix = "" prefixOverrides="AND">
		 	
		 		<!-- rtype -->
				<if test = "!(rtype.isEmpty())">
					<trim prefix = "(" suffix =")"> 
						rtype in
						<foreach collection="rtype" open="(" close=")" separator=", " item="item">
							#{item}
						</foreach>
					</trim> 
				</if>
				
				<!-- btype -->
				<if test = "!(btype.isEmpty())">
					<trim prefix = "AND (" suffix = ")">
						btype in
						<foreach collection="btype" open="(" close=")" separator=", " item="item">
							#{item}
						</foreach>
					</trim>
				</if>
				
				<!-- dep -->
				
				<if test = "!(dep.isEmpty())">
					<trim prefix = "AND (" suffix = ")">
						<foreach collection="dep" open="(" close=")" separator="OR " item="item">
								<choose>
									<when test = "item == 'dep1'">
										<![CDATA[ dep < 500 ]]>
									</when>
									<when test = "item == 'dep2'">
										<![CDATA[ dep >= 500 AND dep < 1000 ]]>
									</when>
									<when test = "item == 'dep3'">
										<![CDATA[ dep > 1000 ]]>
									</when>
								</choose>
						</foreach>
					</trim>
				</if>
				
				<!-- mrent -->
				<if test = "!(dep.isEmpty())">
					<trim prefix = "AND (" suffix = ")">
						<foreach collection="mrent" open="(" close=")" separator="OR " item="item">
								<choose>
									<when test = "item == 'mrent1'">
										<![CDATA[ mrent < 30 ]]>
									</when>
									<when test = "item == 'mrent2'">
										<![CDATA[ mrent >= 30 AND mrent < 60 ]]>
									</when>
									<when test = "item == 'mrent3'">
										<![CDATA[ mrent >= 60 ]]>
									</when>
								</choose>
						</foreach>
					</trim>
				</if>
				<!-- option -->
				<if test = "!(option.isEmpty())">
					<trim prefix = "AND (" suffix =")"> 
						<foreach collection="option" open="(" close=")" separator="AND " item="item">
							<choose>
								<when test = "item == 'elev'">
									elev = 'Y'
								</when>
								<when test = "item == 'park'">
									park = 'Y'
								</when>
								<when test = "item == 'pet'">
									pet = 'Y'
								</when>
							</choose>
						</foreach>
					</trim> 
				</if>
			</trim>
		</where>	
	</select>

</mapper>